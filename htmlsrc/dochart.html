<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>流水线管理系统</title>
	<link rel="shortcut icon" href="./favicon.ico">
   <!-- <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,700">  -->
	<link rel="stylesheet" href="./jmobile/demos/css/themes/default/jquery.mobile-1.4.5.min.css">
	<link rel="stylesheet" href="./jmobile/demos/_assets/css/jqm-demos.css">
	 <link rel="stylesheet" href="./jmobile/jquery-mobile-datepicker-wrapper-master/jquery.mobile.datepicker.css" />
	<script src="./js/jquery-1.11.2.min.js"></script>
	<script src="./jmobile/demos/_assets/js/index.js"></script>
	<script src="./js/jquery.mobile-1.4.5.min.js"></script>
 <script src="./jmobile/jquery-mobile-datepicker-wrapper-master/external/jquery-ui/datepicker.js"></script>
  
  <script src="./jmobile/jquery-mobile-datepicker-wrapper-master/jquery.mobile.datepicker.js"></script>
	
	
	<script type="text/javascript">
	   
		 function GetJsonLT(){
		 
		     $("#sel2").empty(); 
  
			 var option = $("<option>").val(0).text("--请选择制程--");
			 $("#sel2").append(option);
			 $("#sel2").selectmenu("refresh",true);
	
			 $.getJSON("/info_getlt",null,function(data){ 
               
		        $.each(data,function(idx,item){ 
					//if(idx==0){ 
					//	 return true;//同countinue，返回false同break 
					//} 
                   
				    

                option = $("<option>").val(idx+1).text(item.Linetype);
				//alert(item.Linetype+idx);

                $("#sel2").append(option);
				   
		        }); 
				 
					   
		    }); 
			
		 
		 };
	    function GetJsonWS(){
		    $("#sel2").empty();  
			var option = $("<option>").val(-1).text("--请选择车间--");
			$("#sel2").append(option);
		    $("#sel2").val(-1).attr("selected", true); ;
			$("#sel2 :selected").text("--请选择车间--");
			 
			$("#sel2").selectmenu("refresh",true);
			$.getJSON("/info_getws",null,function(data){ 
               
		        $.each(data,function(idx,item){ 
					//if(idx==0){ 
					//	 return true;//同countinue，返回false同break 
					//} 
                   
				    

                option = $("<option>").val(idx+1).text(item.WorkShop);
				//alert(item.WorkShop+idx);

                $("#sel2").append(option);
				   
		        }); 
				 
				 
		    }); 
			
			

        }
		
		function GetJsonSidByWS(){
		    $("#sel3").empty();
			var selectedvalue = $("#sel2  :selected").text(); 
			option = $("<option>").val(0).text("--请选择站点--");			
            $("#sel3").append(option);
			$("#sel3").selectmenu("refresh",true);
			
		    $.getJSON("/sidbyworkshop?workshop="+selectedvalue,null,function(data){ 
               
		        $.each(data,function(idx,item){ 
					

                option = $("<option>").val(idx+1).text(item.Sid);
				//alert(item.WorkShop+idx);

                $("#sel3").append(option);
				   
		        }); 
				 
				 
		    }); 
		
		}
		function GetJsonSidByLT(){
		    $("#sel3").empty();
			var selectedvalue = $("#sel2  :selected").text(); 
			option = $("<option>").val(0).text("--请选择站点--");			
            $("#sel3").append(option);
			$("#sel3").selectmenu("refresh",true);
			
		    $.getJSON("/sidbylinetype?linetype="+selectedvalue,null,function(data){ 
               
		        $.each(data,function(idx,item){ 
					

                option = $("<option>").val(idx+1).text(item.Sid);
				//alert(item.WorkShop+idx);

                $("#sel3").append(option);
				   
		        }); 
				 
				 
		    }); 
		     
		}
		
		function  GetJsonInfoBySid(){
		    selectedvalue = $("#sel3 :selected").text();
			
		    $.getJSON("/infoloaderbylineid?lineid="+selectedvalue+"&&loader=1" ,null,function(data){ 
               	        
				    clearparm();
					$("#workshop").text(data.Workshop);
					$("#linetype").text(data.LineType);
					$("#MachineID").text(data.MachineID);
					$("#MachineName").text(data.MachineName);
					$("#MachineType").text(data.MachineType);
					$("#TotalOutput").text(data.TotalOutput);
					$("#CurOutput").text(data.CurOutput);
					$("#CurTotalOutput").text(data.CurTotalOutput);
					$("#CurPartNum").text(data.CurPartNum);
					$("#CurBatchNum").text(data.CurBatchNum);
					$("#UpdateTime").text(data.UpdateTime);
					$("#LoaderStatus").text(data.LoaderStatus);
					
				 
		    }); 
			
			 $.getJSON("/infoloaderbylineid?lineid="+selectedvalue+"&&loader=0" ,null,function(data){ 
               	        
				     
					//$("#workshop").text(data.Workshop);
					//$("#linetype").text(data.LineType);
					$("#MachineID1").text(data.MachineID);
					$("#MachineName1").text(data.MachineName);
					$("#MachineType1").text(data.MachineType);
					$("#TotalOutput1").text(data.TotalOutput);
					$("#CurOutput1").text(data.CurOutput);
					$("#CurTotalOutput1").text(data.CurTotalOutput);
					$("#CurPartNum1").text(data.CurPartNum);
					$("#CurBatchNum1").text(data.CurBatchNum);
					$("#UpdateTime1").text(data.UpdateTime);
					$("#UnloaderStatus1").text(data.UnloaderStatus);
					
				 
		    }); 
		
		
		}
		function clearparm(){
		
		            $("#workshop").text("");
					$("#linetype").text("");
					$("#MachineID").text("");
					$("#MachineName").text("");
					$("#MachineType").text("");
					$("#TotalOutput").text("");
					$("#CurOutput").text("");
					$("#CurTotalOutput").text("");
					$("#CurPartNum").text("");
					$("#CurBatchNum").text("");
					$("#UpdateTime").text("");
					$("#LoaderStatus").text("");
		            $("#MachineID1").text("");
					$("#MachineName1").text("");
					$("#MachineType1").text("");
					$("#TotalOutput1").text("");
					$("#CurOutput1").text("");
					$("#CurTotalOutput1").text("");
					$("#CurPartNum1").text("");
					$("#CurBatchNum1").text("");
					$("#UpdateTime1").text("");
					$("#UnloaderStatus1").text("");
					
		
		
		}
		
		function SetRadioCheck(){
		    		 
			$("#radio-xiaoshi").attr("disabled",true).checkboxradio("refresh");
			$("#radio-ri").attr("disabled",true).checkboxradio("refresh");				
			$("#radio-ban").attr("disabled",true).checkboxradio("refresh");
			
			 $("#tjts").attr("disabled","disabled");
			
			$("#radio-ribao").click(function(){
			    
				$("#tjdate").text("统计日期：");
				$("#radio-yuebao").attr("checked",false).checkboxradio("refresh");
				$("#radio-zdy1").attr("checked",false).checkboxradio("refresh");
				$("#radio-zdy2").attr("checked",false).checkboxradio("refresh");
				 
				$("#radio-xiaoshi").attr("disabled",false) ;
			    $("#radio-xiaoshi").attr("checked","checked").checkboxradio("refresh") ;
				
				$("#radio-ri").attr("checked",false);
				$("#radio-ri").attr("disabled",true).checkboxradio("refresh");
				$("#radio-ban").attr("checked",false);
				$("#radio-ban").attr("disabled",true).checkboxradio("refresh");
				 
				 //$("#tjts").attr("disabled",true).selectmenu("refresh",true);
				 $("#tjts").attr("disabled",true);
				// $("#tjts").selectmenu("refresh",true);
			
			});
			
			$("#radio-yuebao").click(function(){
			    
				$("#tjdate").text("统计月份：");
				$("#radio-ribao").attr("checked",false).checkboxradio("refresh");
				$("#radio-zdy1").attr("checked",false).checkboxradio("refresh");
				$("#radio-zdy2").attr("checked",false).checkboxradio("refresh");
				 
			    $("#radio-xiaoshi").attr("checked",false) ;
				$("#radio-xiaoshi").attr("disabled",true).checkboxradio("refresh");
				$("#radio-ri").attr("disabled",false).checkboxradio("refresh");
				$("#radio-ri").attr("checked",true);
				
				$("#radio-ban").attr("checked",false);
				$("#radio-ban").attr("disabled",true).checkboxradio("refresh");
				 
				 //$("#tjts").attr("disabled",true).selectmenu("refresh",true);
				 $("#tjts").attr("disabled","disabled");
				// $("#tjts").selectmenu("refresh",true);
			
			});
			
			$("#radio-zdy1").click(function(){
			    
				$("#tjdate").text("开始日期：");
				$("#radio-yuebao").attr("checked",false).checkboxradio("refresh");
				$("#radio-ribao").attr("checked",false).checkboxradio("refresh");
				$("#radio-zdy2").attr("checked",false).checkboxradio("refresh");
				 
			    $("#radio-xiaoshi").attr("checked",false);
				$("#radio-xiaoshi").attr("disabled",true).checkboxradio("refresh");
				
				$("#radio-ri").attr("disabled",false).checkboxradio("refresh");
				$("#radio-ri").attr("checked",true).checkboxradio("refresh");
				
				$("#radio-ban").attr("checked",false);
				$("#radio-ban").attr("disabled",true).checkboxradio("refresh");
				 
				 //$("#tjts").attr("disabled",true).selectmenu("refresh",true);
				 $("#tjts").attr("disabled",false);
				// $("#tjts").selectmenu("refresh",true);
				
				 $("#tjts").empty(); 
				 var i=1;
				 var option;
				 for (i;i<=31;i++){
				    if (i == 1 ){
				      option = $("<option>").val(i).text("--天--");
					 }else{
					   option = $("<option>").val(i).text(i+"天");
					 }
				    $("#tjts").append(option);
				}
				 $("#tjts").selectmenu("refresh",true);
			
			});
			
			$("#radio-zdy2").click(function(){
			    
				$("#tjdate").text("开始日期：");
				$("#radio-yuebao").attr("checked",false).checkboxradio("refresh");
				$("#radio-zdy1").attr("checked",false).checkboxradio("refresh");
				$("#radio-ribao").attr("checked",false).checkboxradio("refresh");
				 
			    $("#radio-xiaoshi").attr("checked",false)
				$("#radio-xiaoshi").attr("disabled",true).checkboxradio("refresh");
				$("#radio-ri").attr("checked",false)
				$("#radio-ri").attr("disabled",true).checkboxradio("refresh");
				$("#radio-ban").attr("disabled",false).checkboxradio("refresh");
				$("#radio-ban").attr("checked",true).checkboxradio("refresh");
				
				 
				 //$("#tjts").attr("disabled",true).selectmenu("refresh",true);
				 $("#tjts").attr("disabled",false);
				// $("#tjts").selectmenu("refresh",true);
				
				$("#tjts").empty(); 
				 var i=1;
				 var option;
				 for (i;i<=10;i++){
				    if (i == 1 ){
				      option = $("<option>").val(i).text("--天--");
					 }else{
					   option = $("<option>").val(i).text(i+"天");
					 }
				    $("#tjts").append(option);
				}
				 $("#tjts").selectmenu("refresh",true);
			
			});
		
		
		
		}
		
		function submitfunc(){
		    
			 
		    $("#submit").click(function () {
			
			    var atype = $('input:radio[name=atype]:checked').val();
			    var aunit = $('input:radio[name=aunit]:checked').val();
			    var adate = $("#tjdateinput").val();
			    var adays = $("#tjts").val();
				var lineid = $("#sel3 :selected").text();
				if (adate == ""){
				    alert("请先选择日期");
					return;
				}
				if (atype == 2 || atype == 3){//如果自定义必须输入天数
					if (adays < 2){
						alert("请先选择天数");
					   return;
					}
				}
			         //datatochart?atype=0&aunit=0&adate=2014-12-12&adays=0&lineid=1
				url = "/datatochart?atype="+atype+"&aunit="+aunit+"&adate="+adate+"&adays="+adays+"&lineid="+lineid ;
				console.log(url);
			    $.getJSON(url,null,function(data){ 
                    if (atype==0 && aunit==0){
		               setechart0(data);
				    }
					 if (atype==1 && aunit==1){
		               setechart1(data);
				    }
					 if (atype==2 && aunit==1){
		               setechart2(data);
				    }
					 if (atype==3 && aunit==2){
		               setechart3(data);
				    }
				});
				  
		    }); 
			
			
			 
		
		
		
		}
		function setechart0(data){
		     var option1= {
                    tooltip: {
                        show: true
                    },
                    legend: {
                        data:['自动运行时间','小时目标产量','每小时产量']
                    },
					grid : {
					    x : 35 ,
						x2 : 35
					},
                    xAxis : [
                        {
                            type : 'category',
                            data : ["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23" ]
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value'
                        }
                    ],
                    series : [
                        {
                            "name":"自动运行时间",
                            "type":"bar",
                            "data":[5, 20, 40, 10, 10, 20]
                        },
						 {
                            "name":"小时目标产量",
                            "type":"line",
                            "data":[15, 30, 30, 10, 20, 20]
                        },
						 {
                            "name":"每小时产量",
                            "type":"line",
                            "data":[15, 30, 30, 10, 20, 20]
                        }
                    ]
                };
				var option2 = $.extend(true, {}, option1); 
				 
				 
				var hourval = data.Plan.PlanDay / 24;
				option2.series[0].data=[];
				option2.series[1].data=[];
				option2.series[2].data=[];
				for (var i=0;i<24;i++){
				   option2.series[1].data.push(hourval);
				   option2.series[2].data.push(0);
				   option2.series[0].data.push(0);
				}
				
				
				option1.legend.data[0]="每小时产量";
				option1.legend.data[1]="日目标产量";
				option1.legend.data[2]="累计产量";
				option1.series[0].name=option1.legend.data[0];
				option1.series[1].name=option1.legend.data[1];
				option1.series[2].name=option1.legend.data[2];
				var sumval = data.Plan.PlanDay  ;
				option1.series[0].data=[];
				option1.series[1].data=[];
				option1.series[2].data=[];
				for (var i=0;i<24;i++){
				   option1.series[1].data.push(sumval);
				   option1.series[2].data.push(0);
				   option1.series[0].data.push(0);
				}
             if (data.Uphstations==null  ) {
				 
				drawechart("main1",0);
				drawechart("main2",0);
				 
				return;
			}
		     $.each(data.Uphstations,function(idx,item){ 
			    
					var  thehours = item.Hours.split(" ");
					var thehour = parseInt(thehours[1])+1;
					option2.series[2].data[thehour] = item.UPH;
					option1.series[0].data[thehour] = item.UPH;
				     
		    }); 
			var sumwhole = 0;
			for (var i=0;i<24;i++){
			    sumwhole = sumwhole+option1.series[0].data[i];
				option1.series[2].data[i] = sumwhole;
			
			}
			
			var pingjunsum = sumwhole/24;
			$("#canneng").text(pingjunsum);
			var pianchachan = sumwhole - data.Plan.PlanDay;
			$("#pianchachan").text(pianchachan);
			 var pianchajin = data.Plan.PlanDay/pingjunsum-24;
			$("#pianchajin").text(pianchajin);
			
			var ss=[0,0,0,0,0];
			if (  data.Statusphs==null) {
				drawechart("main0",0);
				//drawechart("main2",option2);
			    //drawechart("main1",option1);
				 
				//return;
			}else{
			
			 $.each(data.Statusphs,function(idx,item){ 
			        var  thehours = item.Hours.split(" ");
					var thehour = parseInt(thehours[1])+1;
					option2.series[0].data[thehour] = item.S2/(item.S0+item.S1+item.S2+item.S3+item.S4)*60;
			        ss[0]=ss[0]+item.S0;
					ss[1]=ss[1]+item.S1;
					ss[2]=ss[2]+item.S2;
					ss[3]=ss[3]+item.S3;
					ss[4]=ss[4]+item.S4;
			 });
		     } 
			 var jiadonglv = ss[2]/(ss[0]+ss[1]+ss[2]+ss[3]+ss[4]);
			 $("#jiadonglv").text(jiadonglv);
			 
		
		     
		    drawechart("main2",option2);
			drawechart("main1",option1);
			
			
			
			
			var option0 = {
						title : {
							text: '运行状态统计分析',
							subtext: '',
							x:'center'
						},
						tooltip : {
							trigger: 'item',
							formatter: "{a} <br/>{b} : {c} ({d}%)"
						},
						legend: {
							orient : 'vertical',
							x : 'left',
							data:['停止','手动','自动运行中','待机','通信中断']
						},
						/*toolbox: {
							show : true,
							feature : {
								mark : {show: true},
								dataView : {show: true, readOnly: false},
								magicType : {
									show: true, 
									type: ['pie', 'funnel'],
									option: {
										funnel: {
											x: '25%',
											width: '50%',
											funnelAlign: 'left',
											max: 1548
										}
									}
								},
								restore : {show: true},
								saveAsImage : {show: true}
							}
						},*/
						calculable : true,
						series : [
							{
								name:'运行状态',
								type:'pie',
								radius : '55%',
								center: ['50%', '60%'],
								data:[
									{value:ss[0], name:'停止'},
									{value:ss[1], name:'手动'},
									{value:ss[2], name:'自动运行中'},
									{value:ss[3], name:'待机'},
									{value:ss[4], name:'通信中断'}
								]
							}
						]
					};
			
			drawechart("main0",option0);
			
		 }
		function setechart1(data){
		
		 var option1= {
                    tooltip: {
                        show: true
                    },
                    legend: {
                        data:['自动运行时间','日目标产量','每日产量']
                    },
					grid : {
					    x : 45 ,
						x2 : 45
					},
                    xAxis : [
                        {
                            type : 'category',
                            data : ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31"]
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value'
                        }
                    ],
                    series : [
                        {
                            "name":"自动运行时间",
                            "type":"bar",
                            "data":[5, 20, 40, 10, 10, 20]
                        },
						 {
                            "name":"日目标产量",
                            "type":"line",
                            "data":[15, 30, 30, 10, 20, 20]
                        },
						 {
                            "name":"每日产量",
                            "type":"line",
                            "data":[15, 30, 30, 10, 20, 20]
                        }
                    ]
                };
				var option2 = $.extend(true, {}, option1); 
				 
				 
				var dayval = data.Plan.PlanDay  ;
				option2.series[0].data=[];
				option2.series[1].data=[];
				option2.series[2].data=[];
				for (var i=0;i<31;i++){
				   option2.series[1].data.push(dayval);
				   option2.series[2].data.push(0);
				   option2.series[0].data.push(0);
				}
				
				
				option1.legend.data[0]="每日产量";
				option1.legend.data[1]="月目标产量";
				option1.legend.data[2]="累计产量";
				option1.series[0].name=option1.legend.data[0];
				option1.series[1].name=option1.legend.data[1];
				option1.series[2].name=option1.legend.data[2];
				var sumval = data.Plan.PlanMonth  ;
				option1.series[0].data=[];
				option1.series[1].data=[];
				option1.series[2].data=[];
				for (var i=0;i<31;i++){
				   option1.series[1].data.push(sumval);
				   option1.series[2].data.push(0);
				   option1.series[0].data.push(0);
				}
             if (data.Updstations==null  ) {
				 
				drawechart("main1",0);
				drawechart("main2",0);
				 
				return;
			}
		     $.each(data.Updstations,function(idx,item){ 
			    
					var  thedays = item.Days.split("-");
					var theday = parseInt(thedays[2])-1;
					option2.series[2].data[theday] = item.UPD;
					option1.series[0].data[theday] = item.UPD;
					 
				     
		    }); 
			var sumwhole = 0;
			for (var i=0;i<31;i++){
			    sumwhole = sumwhole+option1.series[0].data[i];
				option1.series[2].data[i] = sumwhole;
			
			}
			var pingjunsum = sumwhole/31;
			$("#canneng").text(pingjunsum);
			var pianchachan = sumwhole - data.Plan.PlanMonth;
			$("#pianchachan").text(pianchachan);
			var pianchajin = data.Plan.PlanMonth/pingjunsum-31;
			$("#pianchajin").text(pianchajin);
			
			var ss=[0,0,0,0,0];
			 if ( data.Statuspds==null) {
				drawechart("main0",0);
				
			}else{
			 $.each(data.Statuspds,function(idx,item){ 
			        var  thedays = item.Days.split("-");
					var theday = parseInt(thedays[2])-1;
					option2.series[0].data[theday] = item.S2/(item.S0+item.S1+item.S2+item.S3+item.S4)*60;
			        ss[0]=ss[0]+item.S0;
					ss[1]=ss[1]+item.S1;
					ss[2]=ss[2]+item.S2;
					ss[3]=ss[3]+item.S3;
					ss[4]=ss[4]+item.S4;
			 });
			 }
		     var jiadonglv = ss[2]/(ss[0]+ss[1]+ss[2]+ss[3]+ss[4]);
			 $("#jiadonglv").text(jiadonglv);
		
		     
		    drawechart("main2",option2);
			drawechart("main1",option1);
			
			var option0 = {
						title : {
							text: '运行状态统计分析',
							subtext: '',
							x:'center'
						},
						tooltip : {
							trigger: 'item',
							formatter: "{a} <br/>{b} : {c} ({d}%)"
						},
						legend: {
							orient : 'vertical',
							x : 'left',
							data:['停止','手动','自动运行中','待机','通信中断']
						},
						/*toolbox: {
							show : true,
							feature : {
								mark : {show: true},
								dataView : {show: true, readOnly: false},
								magicType : {
									show: true, 
									type: ['pie', 'funnel'],
									option: {
										funnel: {
											x: '25%',
											width: '50%',
											funnelAlign: 'left',
											max: 1548
										}
									}
								},
								restore : {show: true},
								saveAsImage : {show: true}
							}
						},*/
						calculable : true,
						series : [
							{
								name:'运行状态',
								type:'pie',
								radius : '55%',
								center: ['50%', '60%'],
								data:[
									{value:ss[0], name:'停止'},
									{value:ss[1], name:'手动'},
									{value:ss[2], name:'自动运行中'},
									{value:ss[3], name:'待机'},
									{value:ss[4], name:'通信中断'}
								]
							}
						]
					};
			
			drawechart("main0",option0);
		
		
		}
		
		
		function setechart2(data){
			var option1= {
						tooltip: {
							show: true
						},
						legend: {
							data:['自动运行时间','日目标产量','每日产量']
						},
						grid : {
							x : 45 ,
							x2 : 45
						},
						xAxis : [
							{
								type : 'category',
								data : ["1","2"]
							}
						],
						yAxis : [
							{
								type : 'value'
							}
						],
						series : [
							{
								"name":"自动运行时间",
								"type":"bar",
								"data":[5, 20, 40, 10, 10, 20]
							},
							 {
								"name":"日目标产量",
								"type":"line",
								"data":[15, 30, 30, 10, 20, 20]
							},
							 {
								"name":"每日产量",
								"type":"line",
								"data":[15, 30, 30, 10, 20, 20]
							}
						]
					};
					option1.xAxis[0].data = [];
					var daycount = $("#tjts").val();
					var startday = parseInt($("#tjdateinput").val().split("-")[2]);
					for (var i=0;i < daycount; i++){
					   option1.xAxis[0].data.push(startday+i);
					}
					
					
					var option2 = $.extend(true, {}, option1); 
					 
					 
					var dayval = data.Plan.PlanDay  ;
					option2.series[0].data=[];
					option2.series[1].data=[];
					option2.series[2].data=[];
					for (var i=0;i < daycount ; i++){
					   option2.series[1].data.push(dayval);
					   option2.series[2].data.push(0);
					   option2.series[0].data.push(0);
					}
					
					
					option1.legend.data[0]="每日产量";
					option1.legend.data[1]="月目标产量";
					option1.legend.data[2]="累计产量";
					option1.series[0].name=option1.legend.data[0];
					option1.series[1].name=option1.legend.data[1];
					option1.series[2].name=option1.legend.data[2];
					var sumval = data.Plan.PlanMonth  ;
					option1.series[0].data=[];
					option1.series[1].data=[];
					option1.series[2].data=[];
					for (var i=0;i < daycount ; i++){
					   option1.series[1].data.push(sumval);
					   option1.series[2].data.push(0);
					   option1.series[0].data.push(0);
					}
				 if (data.Updstations==null  ) {
					 
					drawechart("main1",0);
					drawechart("main2",0);
					 
					return;
				}
				 $.each(data.Updstations,function(idx,item){ 
					
						var  thedays = item.Days.split("-");
						var theday = parseInt(thedays[2])-startday;
						option2.series[2].data[theday] = item.UPD;
						option1.series[0].data[theday] = item.UPD;
						 
						 
				}); 
				var sumwhole = 0;
				for (var i=0;i < daycount;i++){
					sumwhole = sumwhole+option1.series[0].data[i];
					option1.series[2].data[i] = sumwhole;
				
				}
				var pingjunsum = sumwhole/daycount;
			    $("#canneng").text(pingjunsum);
				var pianchachan = sumwhole - data.Plan.PlanDay*daycount;
			    $("#pianchachan").text(pianchachan);
				var pianchajin = data.Plan.PlanDay*daycount/pingjunsum-daycount;
			    $("#pianchajin").text(pianchajin);
			
				var ss=[0,0,0,0,0];
				if ( data.Statuspds==null) {
				   drawechart("main0",0);
				 
			    }else{
				 $.each(data.Statuspds,function(idx,item){ 
						var  thedays = item.Days.split("-");
						var theday = parseInt(thedays[2])-startday;
						option2.series[0].data[theday] = item.S2/(item.S0+item.S1+item.S2+item.S3+item.S4)*60;
						ss[0]=ss[0]+item.S0;
						ss[1]=ss[1]+item.S1;
						ss[2]=ss[2]+item.S2;
						ss[3]=ss[3]+item.S3;
						ss[4]=ss[4]+item.S4;
				 });
				 }
			     var jiadonglv = ss[2]/(ss[0]+ss[1]+ss[2]+ss[3]+ss[4]);
			     $("#jiadonglv").text(jiadonglv);
			
				 
				drawechart("main2",option2);
				drawechart("main1",option1);
				
				var option0 = {
							title : {
								text: '运行状态统计分析',
								subtext: '',
								x:'center'
							},
							tooltip : {
								trigger: 'item',
								formatter: "{a} <br/>{b} : {c} ({d}%)"
							},
							legend: {
								orient : 'vertical',
								x : 'left',
								data:['停止','手动','自动运行中','待机','通信中断']
							},
							/*toolbox: {
								show : true,
								feature : {
									mark : {show: true},
									dataView : {show: true, readOnly: false},
									magicType : {
										show: true, 
										type: ['pie', 'funnel'],
										option: {
											funnel: {
												x: '25%',
												width: '50%',
												funnelAlign: 'left',
												max: 1548
											}
										}
									},
									restore : {show: true},
									saveAsImage : {show: true}
								}
							},*/
							calculable : true,
							series : [
								{
									name:'运行状态',
									type:'pie',
									radius : '55%',
									center: ['50%', '60%'],
									data:[
										{value:ss[0], name:'停止'},
										{value:ss[1], name:'手动'},
										{value:ss[2], name:'自动运行中'},
										{value:ss[3], name:'待机'},
										{value:ss[4], name:'通信中断'}
									]
								}
							]
						};
				
				drawechart("main0",option0);
		
		
		
		}
		function setechart3(data){
			var option1= {
						tooltip: {
							show: true
						},
						legend: {
							data:['自动运行时间','班目标产量','每班产量']
						},
						grid : {
							x : 45 ,
							x2 : 45
						},
						xAxis : [
							{
								type : 'category',
								data : ["1","2"]
							}
						],
						yAxis : [
							{
								type : 'value'
							}
						],
						series : [
							{
								"name":"自动运行时间",
								"type":"bar",
								"data":[5, 20, 40, 10, 10, 20]
							},
							 {
								"name":"班目标产量",
								"type":"line",
								"data":[15, 30, 30, 10, 20, 20]
							},
							 {
								"name":"每班产量",
								"type":"line",
								"data":[15, 30, 30, 10, 20, 20]
							}
						]
					};
					option1.xAxis[0].data = [];
					var daycount = $("#tjts").val();
					var startday = parseInt($("#tjdateinput").val().split("-")[2]);
					for (var i=0;i < daycount; i++){
					   option1.xAxis[0].data.push(startday+i+"早");
					   option1.xAxis[0].data.push(startday+i+"中");
					   option1.xAxis[0].data.push(startday+i+"晚");
					}
					
					
					var option2 = $.extend(true, {}, option1); 
					 
					 
					var banval = data.Plan.PlanBan  ;
					option2.series[0].data=[];
					option2.series[1].data=[];
					option2.series[2].data=[];
					for (var i=0;i < daycount*3 ; i++){
					   option2.series[1].data.push(banval);
					   option2.series[2].data.push(0);
					   option2.series[0].data.push(0);
					}
					
					
					option1.legend.data[0]="每班产量";
					option1.legend.data[1]="月目标产量";
					option1.legend.data[2]="累计产量";
					option1.series[0].name=option1.legend.data[0];
					option1.series[1].name=option1.legend.data[1];
					option1.series[2].name=option1.legend.data[2];
					var sumval = data.Plan.PlanMonth  ;
					option1.series[0].data=[];
					option1.series[1].data=[];
					option1.series[2].data=[];
					for (var i=0;i < daycount*3 ; i++){
					   option1.series[1].data.push(sumval);
					   option1.series[2].data.push(0);
					   option1.series[0].data.push(0);
					}
				 if (data.Upsstations==null  ) {
					 
					drawechart("main1",0);
					drawechart("main2",0);
					 
					return;
				}
				 
				 $.each(data.Upsstations,function(idx,item){ 
					
						var  thedays = item.Days.split("-");
						var theday = parseInt(thedays[2])-startday;
						theday = 3*theday;
						option2.series[2].data[theday] = item.Shift1;
						option2.series[2].data[theday+1] = item.Shift2;
						option2.series[2].data[theday+2] = item.Shift3;
						option1.series[0].data[theday] = item.Shift1;
						option1.series[0].data[theday+1] = item.Shift2;
						option1.series[0].data[theday+2] = item.Shift3;
						 
						 
						 
				}); 
				var sumwhole = 0;
				for (var i=0;i < daycount*3;i++){
					sumwhole = sumwhole+option1.series[0].data[i];
					option1.series[2].data[i] = sumwhole;
				
				}
				var pingjunsum = sumwhole/(daycount*3);
			    $("#canneng").text(pingjunsum);
				var pianchachan = sumwhole - data.Plan.PlanDay*daycount;
			    $("#pianchachan").text(pianchachan);
				var pianchajin = data.Plan.PlanBan/pingjunsum-daycount*3;
			    $("#pianchajin").text(pianchajin);
			   
				var ss=[0,0,0,0,0];
				 if (  data.Statuspss==null) {
				    drawechart("main0",0);
				  
			    }else{
				 $.each(data.Statuspss,function(idx,item){ 
						var  thedays = item.Days.split("-");
						var theday = parseInt(thedays[2])-startday;
						theday  = theday  *3;
						option2.series[0].data[theday] = item.S1_S2/(item.S1_S0+item.S1_S1+item.S1_S2+item.S1_S3+item.S1_S4)*60;
						option2.series[0].data[theday+1] = item.S2_S2/(item.S2_S0+item.S2_S1+item.S2_S2+item.S2_S3+item.S2_S4)*60;
						option2.series[0].data[theday+2] = item.S3_S2/(item.S3_S0+item.S3_S1+item.S3_S2+item.S3_S3+item.S3_S4)*60;
						ss[0]=ss[0]+item.S1_S0+item.S2_S0+item.S3_S0;
						ss[1]=ss[1]+item.S1_S1+item.S2_S1+item.S3_S1;
						ss[2]=ss[2]+item.S1_S2+item.S2_S2+item.S3_S2;
						ss[3]=ss[3]+item.S1_S3+item.S2_S3+item.S3_S3;
						ss[4]=ss[4]+item.S1_S4+item.S2_S4+item.S3_S4;
				 });
				 }
			     var jiadonglv = ss[2]/(ss[0]+ss[1]+ss[2]+ss[3]+ss[4]);
			     $("#jiadonglv").text(jiadonglv);
			
				 
				drawechart("main2",option2);
				drawechart("main1",option1);
				
				var option0 = {
							title : {
								text: '运行状态统计分析',
								subtext: '',
								x:'center'
							},
							tooltip : {
								trigger: 'item',
								formatter: "{a} <br/>{b} : {c} ({d}%)"
							},
							legend: {
								orient : 'vertical',
								x : 'left',
								data:['停止','手动','自动运行中','待机','通信中断']
							},
							/*toolbox: {
								show : true,
								feature : {
									mark : {show: true},
									dataView : {show: true, readOnly: false},
									magicType : {
										show: true, 
										type: ['pie', 'funnel'],
										option: {
											funnel: {
												x: '25%',
												width: '50%',
												funnelAlign: 'left',
												max: 1548
											}
										}
									},
									restore : {show: true},
									saveAsImage : {show: true}
								}
							},*/
							calculable : true,
							series : [
								{
									name:'运行状态',
									type:'pie',
									radius : '55%',
									center: ['50%', '60%'],
									data:[
										{value:ss[0], name:'停止'},
										{value:ss[1], name:'手动'},
										{value:ss[2], name:'自动运行中'},
										{value:ss[3], name:'待机'},
										{value:ss[4], name:'通信中断'}
									]
								}
							]
						};
				
				drawechart("main0",option0);
		
		
		
		
		}
		$(document).ready(function(){ 
		submitfunc();
		SetRadioCheck(); 
        $("#sel2").empty();
		$("#sel3").empty();
		clearparm();
		$("#sel1").change(function(){
		
		       
		       var sel1value = $("#sel1").val();
			  
			   if (sel1value == "1")
			   {
			  
			      GetJsonWS();
			      
			   }
			   else
			   {
			    
			      GetJsonLT();
				 
			   }
		
		
		});
		
		$("#sel2").change(function(){
		     var sel2value = $('#sel2 option:first').val();
			
			 if (sel2value == -1)
			 {
			    
			    GetJsonSidByWS();
			 }
			 else
			 {
			 
			     GetJsonSidByLT();
			 
			 }
		
		
		});
		
		$("#sel3").change(function(){
		     
		       GetJsonInfoBySid();
		
		});
		});
	  
	  </script>
</head>
<body>
<div data-role="page" class="jqm-demos" data-quicklinks="true">

	<div data-role="header" data-position="fixed" >
	 <h1>流水线管理系统</h1>
	 <div data-role="navbar">
	    <ul>
		<li><a rel="external" href="/src/index.html" >设备状态</a></li>
		<li><a rel="external" href="/src/devinfo.html" >设备详情</a></li>
		<li><a rel="external" href="/src/dochart.html" >统计图表</a></li>
		<li><a  rel="external" href="/src/alarms.html" >活动告警</a></li>
		</ul>
	 </div>
	</div><!-- /header -->

	<div data-role="content"  >
	   <ul data-role="listview"  id="listview">
	      <li data-role="list-divider"> 筛选
		  
		 <li> <div class="ui-grid-a">
		 <select   id="sel1">
	<option selected="selected" value="0" >--请选择查询方式--</option>
	<option  value="1">按车间查询</option>
	<option value="2">按制程查询</option>

</select>
 <select    id="sel2">
	<option selected="selected" value="0">--请选择车间--</option>
	<option value="1">{第01号车间</option>
	<option value="2">{第03号车间</option>
	<option value="3">{第07号车间</option>
	<option value="4">{第15号车间</option>

</select>


                 <select   id="sel3">
	<option selected="selected" value="0">--请选择站号--</option>
	<option value="1">{21</option>
	<option value="2">{22</option>
	<option value="3">{23</option>
	<option value="4">{24</option>
	<option value="5">{25</option>
	<option value="6">{26</option>
         </select>
		 </div>
		 <li data-role="list-divider">统计定义
		 <li><form>
    <fieldset data-role="controlgroup"   >
        <legend>统计类型：</legend>
        <label for="radio-ribao">日报</label>
        <input type="radio" name="atype" id="radio-ribao" value="0" checked="checked">
        <label for="radio-yuebao">月报</label>
        <input type="radio" name="atype" id="radio-yuebao" value="1">
        <label for="radio-zdy1">自定义(1)</label>
        <input type="radio" name="atype" id="radio-zdy1" value="2">
        <label for="radio-zdy2">自定义(2)</label>
        <input type="radio" name="atype" id="radio-zdy2" value="3">
        
    </fieldset>
</form></li>

		<li> <form>
    <fieldset data-role="controlgroup" >
        <legend>时间单位：</legend>
        <label for="radio-xiaoshi">小时</label>
        <input type="radio" name="aunit" id="radio-xiaoshi" value="0" checked="checked">
        <label for="radio-ri">日</label> 
        <input type="radio" name="aunit" id="radio-ri" value="1">
        <label for="radio-ban">班</label>
        <input type="radio" name="aunit" id="radio-ban" value="2">
        
    </fieldset>
     </form> </li>
	 
				 <li>  				 
						<legend id="tjdate">统计日期：</legend>
				 
					 
				      <!--  <input type="text" id="date-input" data-inline="false" data-role="date">  -->
					  <input type="date" id="tjdateinput"/>
                         
					 
					 
				 </li>
		<li> 	<legend>统计天数：</legend>
				 
					 
					    <select id="tjts" >
						   <option selected="selected"   value=0>--天--</option>
						</select>

					 
					 
				 </li>
			<li><input type="button"  id="submit"  name="提交"  value="开始统计"> </li>
		 <li data-role="list-divider">统计分析
		 <li> <div class="ui-grid-a">
					<div class="ui-block-a">
						<p>稼动率：</p>
					</div> 
					<div class="ui-block-b">
						<p id="jiadonglv">   </p>
					</div> 
					 
				</div></li>
		<li> <div class="ui-grid-a">
					<div class="ui-block-a">
						<p>平均产能：</p>
					</div> 
					<div class="ui-block-b">
						<p id="canneng"> </p>
					</div> 
					 
				</div></li>
		<li> <div class="ui-grid-a">
					<div class="ui-block-a">
						<p>产量偏差：</p>
					</div> 
					<div class="ui-block-b">
						<p id="pianchachan"> </p>
					</div> 
					 
				</div></li>
		<li> <div class="ui-grid-a">
					<div class="ui-block-a">
						<p>进度偏差：</p>
					</div> 
					<div class="ui-block-b">
						<p id="pianchajin"> </p>
					</div> 
					 
				</div></li>
		
		
				
		<li data-role="list-divider">统计饼图</li>
		 <div id="main0" style="height:400px"></div>
    <!-- ECharts单文件引入 -->
    <script src="./jmobile/echarts-2.2.1/build/dist/echarts.js"></script>
	<script type="text/javascript">
	   function drawechart(id_div,optionset){
	   
	         require.config({
            paths: {
                echarts: './jmobile/echarts-2.2.1/build/dist'
            }
        });
        
        // 使用
        require(
            [
                'echarts',
                'echarts/chart/pie' ,// 使用柱状图就加载bar模块，按需加载
				'echarts/chart/line' ,
				'echarts/chart/bar' ,
            ],
            function (ec) {
                // 基于准备好的dom，初始化echarts图表
                var myChart = ec.init(document.getElementById(id_div)); 
                
                var option = optionset;
        
                // 为echarts对象加载数据 
                myChart.setOption(option); 
            }
        );
	   
	   
	   
	   };
	
	
	</script>
    <script type="text/javascript">
	    var option = {
						title : {
							text: '某站点用户访问来源',
							subtext: '纯属虚构',
							x:'center'
						},
						tooltip : {
							trigger: 'item',
							formatter: "{a} <br/>{b} : {c} ({d}%)"
						},
						legend: {
							orient : 'vertical',
							x : 'left',
							data:['直接访问','邮件营销','联盟广告','视频广告','搜索引擎']
						},
						/*toolbox: {
							show : true,
							feature : {
								mark : {show: true},
								dataView : {show: true, readOnly: false},
								magicType : {
									show: true, 
									type: ['pie', 'funnel'],
									option: {
										funnel: {
											x: '25%',
											width: '50%',
											funnelAlign: 'left',
											max: 1548
										}
									}
								},
								restore : {show: true},
								saveAsImage : {show: true}
							}
						},*/
						calculable : true,
						series : [
							{
								name:'访问来源',
								type:'pie',
								radius : '55%',
								center: ['50%', '60%'],
								data:[
									{value:335, name:'直接访问'},
									{value:310, name:'邮件营销'},
									{value:234, name:'联盟广告'},
									{value:135, name:'视频广告'},
									{value:1548, name:'搜索引擎'}
								]
							}
						]
					};
            // drawechart("main0",option);
    </script>
		 
		 
		 <li data-role="list-divider">产量走势图</li>
		  <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="main1" style="height:400px"></div>
    <!-- ECharts单文件引入 -->
    
    <script type="text/javascript">
       
                var option = {
                    tooltip: {
                        show: true
                    },
                    legend: {
                        data:['销量','销量1']
                    },
					grid : {
					    x : 25 ,
						x2 : 25
					},
                    xAxis : [
                        {
                            type : 'category',
                            data : ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value'
                        }
                    ],
                    series : [
                        {
                            "name":"销量",
                            "type":"bar",
                            "data":[5, 20, 40, 10, 10, 20]
                        },
						 {
                            "name":"销量1",
                            "type":"line",
                            "data":[15, 30, 30, 10, 20, 20]
                        }
                    ]
                };
        
             //   drawechart("main1",option);
           
    </script>
		 
		 <li data-role="list-divider">单位产量图</li>
		  <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="main2" style="height:400px"></div>
    <!-- ECharts单文件引入 -->
   
    <script type="text/javascript">
        
                    
                var option = {
                    tooltip: {
                        show: true
                    },
                    legend: {
                        data:['销量']
                    },
					grid : {
					    x : 25 ,
						x2 : 25
					},
                    xAxis : [
                        {
                            type : 'category',
                            data : ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"]
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value'
                        }
                    ],
                    series : [
                        {
                            "name":"销量",
                            "type":"bar",
                            "data":[1, 30, 50, 20, 20, 30]
                        }
                    ]
                };
        
             //    drawechart("main2",option);
		
		 
	    </script>
	   </ul>
	</div> 
	<div data-role="footer"  >
	   <div data-role="navbar">
	    <ul>
		<li><a rel="external" href="/src/index.html" >设备状态</a></li>
		<li><a rel="external" href="/src/devinfo.html" >设备详情</a></li>
		<li><a href="#index" >统计图表</a></li>
		<li><a  rel="external" href="/src/alarms.html" >活动告警</a></li>
		</ul>
	 </div>
	</div> 


</div><!-- /page -->

</body>
</html>
